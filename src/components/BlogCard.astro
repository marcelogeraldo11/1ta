---
import { SITE_BASE } from '@/consts'
import FormattedDate from './FormattedDate.astro'
import type { ImageMetadata } from 'astro'
import { Image } from 'astro:assets'

const { post } = Astro.props

const blogImages = import.meta.glob<{ default: ImageMetadata }>(
	'/src/assets/blogimages/**/*.{jpeg,jpg,png,gif}'
)

const coverImagePath = `/src/assets/blogimages/${post.slug}/cover.jpg`
const coverImageUrl = post.data.coverImageUrl
---

<a
	href={`${SITE_BASE}/blog/${post.slug}/`}
	class="flex flex-col gap-5 pb-8 h-full group transition-colors"
>
	{
		coverImageUrl ? (
			<img
				src={coverImageUrl}
				alt={post.data.title}
				class="object-cover rounded-xl aspect-video"
			/>
		) : blogImages[coverImagePath] ? (
			<Image
				src={blogImages[coverImagePath]()}
				alt={post.data.title}
				class="object-cover rounded-xl aspect-video"
			/>
		) : null
	}
	<h4
		class="text-2xl font-semibold leading-snug text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-primary-dark group-hover:underline transition-colors"
	>
		{post.data.title}
	</h4>
	<p class="line-clamp-4 text-base md:text-lg leading-7 text-gray-700 dark:text-gray-300 antialiased">
		{post.data.description}
	</p>
	<p class="uppercase text-sm leading-6 mt-auto tracking-wide text-gray-600 dark:text-gray-400">
		<FormattedDate date={post.data.pubDate} />
	</p>
</a>
